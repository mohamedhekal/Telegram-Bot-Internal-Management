#!/bin/bash

# ุณูุฑูุจุช ุงูุชุดุบูู ุงูุณุฑูุน ููุจูุช ุนูู ุงูุณูุฑูุฑ
# Server: 31.97.233.18
# Path: /var/www/leads_rockli_usr/data/www/leads.rocklis.com

echo "๐ ุชุดุบูู ุณุฑูุน ููุจูุช..."
echo "========================"

# ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงููุดุฑูุน
cd /var/www/leads_rockli_usr/data/www/leads.rocklis.com || {
    echo "โ ูุดู ูู ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงููุดุฑูุน"
    exit 1
}

# ุฅููุงู ุงูุจูุชุงุช ุงูุฌุงุฑูุฉ
echo "๐ ุฅููุงู ุงูุจูุชุงุช ุงูุฌุงุฑูุฉ..."
pkill -f "python.*bot_clean" 2>/dev/null || true
sleep 2

# ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุฅุฐุง ูุฌุฏุช
if [ -d "venv" ]; then
    echo "๐ง ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
    source venv/bin/activate
fi

# ุชุดุบูู ุงูุจูุช
echo "๐ ุชุดุบูู ุงูุจูุช..."
nohup python3 start_bot.py > bot.log 2>&1 &
BOT_PID=$!

# ุญูุธ ูุนุฑู ุงูุนูููุฉ
echo $BOT_PID > bot.pid

# ุงูุชุธุงุฑ ูููู
sleep 3

# ุงูุชุญูู ูู ุงูุชุดุบูู
if ps -p $BOT_PID > /dev/null; then
    echo "โ ุงูุจูุช ูุนูู ุจูุฌุงุญ! (PID: $BOT_PID)"
    echo "๐ฑ ููููู ุงูุขู ุงุณุชุฎุฏุงู ุงูุจูุช ูู ุชูููุฌุฑุงู"
    echo "๐ ููุฑุงูุจุฉ ุงูุณุฌูุงุช: tail -f bot.log"
    echo "๐ ูุฅููุงู ุงูุจูุช: kill $BOT_PID"
else
    echo "โ ูุดู ูู ุชุดุบูู ุงูุจูุช"
    echo "๐ ุฑุงุฌุน ุงูุณุฌูุงุช: cat bot.log"
    exit 1
fi

echo "========================"
echo "๐ ุงูุจูุช ุฌุงูุฒ ููุงุณุชุฎุฏุงู!"
