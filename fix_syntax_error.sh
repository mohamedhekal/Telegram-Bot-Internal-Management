#!/bin/bash
# ุณูุฑูุจุช ุฅุตูุงุญ ุฎุทุฃ ุงูุชูุณูู ูู bot_clean.py

echo "๐ง ุจุฏุก ุฅุตูุงุญ ุฎุทุฃ ุงูุชูุณูู ูู bot_clean.py..."
echo "=========================================="

# 1. ูุณุฎ ุงุญุชูุงุทูุฉ
echo "1๏ธโฃ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ..."
BACKUP_FILE="bot_clean_backup_$(date +%Y%m%d_%H%M%S).py"
cp bot_clean.py "$BACKUP_FILE"
echo "โ ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: $BACKUP_FILE"

# 2. ูุญุต ุงูููู ุงูุญุงูู
echo ""
echo "2๏ธโฃ ูุญุต ุงูููู ุงูุญุงูู..."
if python3 -m py_compile bot_clean.py; then
    echo "โ ุงูููู ุตุญูุญ ูู ูุงุญูุฉ ุงูุชูุณูู"
else
    echo "โ ููุฌุฏ ุฎุทุฃ ูู ุงูุชูุณูู"
fi

# 3. ูุญุต ููุงูุฉ ุงูููู
echo ""
echo "3๏ธโฃ ูุญุต ููุงูุฉ ุงูููู..."
tail -5 bot_clean.py

# 4. ุฅุตูุงุญ ููุงูุฉ ุงูููู ุฅุฐุง ูุฒู ุงูุฃูุฑ
echo ""
echo "4๏ธโฃ ุฅุตูุงุญ ููุงูุฉ ุงูููู..."
# ุญุฐู ุงูุณุทุฑ ุงูุฃุฎูุฑ ุฅุฐุง ูุงู ุบูุฑ ุตุญูุญ
sed -i '/^[[:space:]]*main()[[:space:]]*$/d' bot_clean.py

# ุฅุถุงูุฉ ุงูููุงูุฉ ุงูุตุญูุญุฉ
cat >> bot_clean.py << 'EOF'

if __name__ == "__main__":
    main()
EOF

echo "โ ุชู ุฅุตูุงุญ ููุงูุฉ ุงูููู"

# 5. ุงุฎุชุจุงุฑ ุงูููู ูุฑุฉ ุฃุฎุฑู
echo ""
echo "5๏ธโฃ ุงุฎุชุจุงุฑ ุงูููู ุจุนุฏ ุงูุฅุตูุงุญ..."
if python3 -m py_compile bot_clean.py; then
    echo "โ ุงูููู ุตุญูุญ ุงูุขู"
else
    echo "โ ูุง ูุฒุงู ููุงู ุฎุทุฃ"
    echo "๐ก ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ..."
    cp "$BACKUP_FILE" bot_clean.py
    exit 1
fi

# 6. ูุญุต ุญุงูุฉ ุงูุฎุฏูุฉ
echo ""
echo "6๏ธโฃ ูุญุต ุญุงูุฉ ุงูุฎุฏูุฉ..."
if command -v systemctl &> /dev/null; then
    echo "ุญุงูุฉ ุงูุฎุฏูุฉ:"
    systemctl status rksorderbot.service --no-pager -l
else
    echo "โน๏ธ systemctl ุบูุฑ ูุชุงุญ"
fi

echo ""
echo "=========================================="
echo "โ ุงูุชูู ุฅุตูุงุญ ุฎุทุฃ ุงูุชูุณูู"
echo "๐ก ุฅุฐุง ููุช ุชุฑูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉุ ุงุณุชุฎุฏู:"
echo "   sudo systemctl restart rksorderbot.service"
