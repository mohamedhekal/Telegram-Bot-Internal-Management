# دليل استخدام ميزة إعادة توجيه الرسائل 📤

## نظرة عامة
ميزة إعادة توجيه الرسائل تسمح لك بإرسال رسائل تحتوي على بيانات الفواتير إلى البوت، وسيتم تحويلها تلقائياً إلى فواتير وإرسالها إلى API.

## كيفية الاستخدام 🚀

### 1. إعادة توجيه رسالة من تيليجرام
1. **ابحث عن الرسالة** التي تحتوي على بيانات الفاتورة
2. **اضغط مطولاً** على الرسالة
3. **اختر "إعادة توجيه"** (Forward)
4. **اختر البوت** كوجهة الإعادة
5. **اضغط إرسال**

### 2. تنسيق البيانات المطلوب 📋

#### التنسيق المفضل (كل حقل في سطر منفصل):
```
اسم الموظفة /نور
أسم العميل/ محمد
المحافظة/ الانبار
اقرب نقطة دالة / الرمادي
الرقم/ 0782444
العدد/ 1
السعر / 40000
الملاحظات/ لاشيئ
```

#### التنسيق البديل (سطر واحد):
```
نور/محمد/الانبار/الرمادي/0782444/1/40000/لاشيئ
```

### 3. الحقول المطلوبة 📝

| الحقل | الوصف | مثال |
|-------|--------|------|
| اسم الموظفة | اسم الموظف المسؤول | نور |
| أسم العميل | اسم العميل | محمد |
| المحافظة | محافظة العميل | الانبار |
| اقرب نقطة دالة | أقرب نقطة دالة للعميل | الرمادي |
| الرقم | رقم هاتف العميل | 0782444 |
| العدد | عدد الوحدات | 1 |
| السعر | سعر الوحدة بالدينار | 40000 |
| الملاحظات | ملاحظات إضافية (اختياري) | لاشيئ |

## سير العمل 🔄

### 1. استلام الرسالة
- البوت يستقبل الرسالة المعاد توجيهها
- يتحقق من أن المستخدم مصرح له
- يعرض رسالة تأكيد

### 2. تحليل البيانات
- يحلل تنسيق الرسالة
- يستخرج البيانات المطلوبة
- يتحقق من صحة البيانات

### 3. إنشاء الفاتورة
- ينشئ رقم إيصال فريد
- يحفظ البيانات في قاعدة البيانات المحلية
- يعرض رسالة تأكيد

### 4. إرسال إلى API
- يرسل الطلب إلى النظام الخارجي
- يسجل نتيجة الإرسال
- يعرض حالة API للمستخدم

## أمثلة عملية 💡

### مثال 1: فاتورة بسيطة
```
اسم الموظفة /أحمد
أسم العميل/ فاطمة
المحافظة/ بغداد
اقرب نقطة دالة / الكاظمية
الرقم/ 0771234567
العدد/ 2
السعر / 25000
الملاحظات/ توصيل سريع
```

### مثال 2: فاتورة بدون ملاحظات
```
اسم الموظفة /سارة
أسم العميل/ علي
المحافظة/ البصرة
اقرب نقطة دالة / العشار
الرقم/ 0789876543
العدد/ 1
السعر / 150000
الملاحظات/ 
```

### مثال 3: تنسيق سطر واحد
```
أحمد/فاطمة/بغداد/الكاظمية/0771234567/2/25000/توصيل سريع
```

## رسائل التأكيد ✅

### عند النجاح:
```
✅ تم إضافة الفاتورة بنجاح!

📋 تفاصيل الفاتورة:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔢 رقم الإيصال: INV-20240115123456
👤 اسم الموظفة: نور
👥 أسم العميل: محمد
🏛️ المحافظة: الانبار
📍 أقرب نقطة دالة: الرمادي
📞 الرقم: 0782444
📦 العدد: 1
💰 السعر: 40,000 دينار
📝 الملاحظات: لاشيئ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏰ التاريخ: 2024-01-15 12:34

🌐 حالة API:
✅ تم إرسال الطلب إلى النظام الخارجي بنجاح
🆔 معرف الطلب: 12345
📋 مجموعة الطلب: GRP-20240115-001
```

### عند الفشل:
```
❌ خطأ في تنسيق البيانات!

الرجاء إدخال جميع البيانات بالترتيب:
اسم الموظفة /نور
أسم العميل/ محمد
المحافظة/ الانبار
اقرب نقطة دالة / الرمادي
الرقم/ 0782444
العدد/ 1
السعر / 40000
الملاحظات/ لاشيئ
```

## الأخطاء الشائعة وحلولها 🔧

### 1. خطأ في تنسيق البيانات
**المشكلة**: البيانات غير مكتملة أو خاطئة
**الحل**: تأكد من إدخال جميع الحقول بالترتيب الصحيح

### 2. خطأ في رقم الهاتف
**المشكلة**: رقم الهاتف غير صحيح
**الحل**: تأكد من أن الرقم يحتوي على أرقام فقط وطوله 10 أرقام على الأقل

### 3. خطأ في السعر أو العدد
**المشكلة**: السعر أو العدد ليس رقماً
**الحل**: تأكد من إدخال أرقام صحيحة أكبر من صفر

### 4. فشل في إرسال API
**المشكلة**: فشل في الاتصال بالنظام الخارجي
**الحل**: سيتم إعادة المحاولة تلقائياً، يمكنك استخدام زر "إعادة المحاولة"

## نصائح للاستخدام الأمثل 💡

### 1. تنسيق البيانات
- استخدم التنسيق المفضل (كل حقل في سطر منفصل)
- تأكد من وجود `/` بين اسم الحقل والقيمة
- تجنب المسافات الزائدة

### 2. التحقق من البيانات
- تأكد من صحة رقم الهاتف
- تأكد من أن السعر والعدد أرقام صحيحة
- تأكد من صحة اسم المحافظة

### 3. الملاحظات
- يمكن ترك الملاحظات فارغة
- استخدم الملاحظات للمعلومات الإضافية المهمة

## الميزات الإضافية ⭐

### 1. دعم التنسيقات المتعددة
- التنسيق الجديد (أسطر منفصلة)
- التنسيق القديم (سطر واحد)
- التنسيق المختلط

### 2. التحقق التلقائي
- التحقق من صحة البيانات
- التحقق من رقم الهاتف
- التحقق من السعر والعدد

### 3. التكامل مع API
- إرسال تلقائي للنظام الخارجي
- تسجيل حالة الإرسال
- إمكانية إعادة المحاولة

### 4. الأمان
- التحقق من صلاحيات المستخدم
- تسجيل جميع العمليات
- حماية من الأخطاء

## استكشاف الأخطاء 🔍

### إذا لم تعمل الميزة:

1. **تحقق من الصلاحيات**
   - تأكد من أنك مصرح لك باستخدام البوت

2. **تحقق من التنسيق**
   - تأكد من صحة تنسيق البيانات
   - تأكد من وجود جميع الحقول المطلوبة

3. **تحقق من الاتصال**
   - تأكد من اتصال الإنترنت
   - تحقق من حالة البوت

4. **تحقق من السجلات**
   - راجع رسائل الخطأ
   - اتصل بالدعم التقني إذا لزم الأمر

## الدعم التقني 🛠️

إذا واجهت أي مشاكل:

1. **راجع هذا الدليل** أولاً
2. **اختبر التنسيق** باستخدام الأمثلة
3. **تحقق من الأخطاء الشائعة**
4. **اتصل بالدعم التقني** مع تفاصيل المشكلة

---

**تاريخ الإنشاء**: 15 يناير 2024  
**الإصدار**: 1.0  
**المطور**: RKS Team
